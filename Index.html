<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoLearn - Learn Sustainability Through Action</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* Basic Styles - assuming some are in style.css */
    body { font-family: 'Poppins', sans-serif; margin: 0; color: #333; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .btn-primary, .btn-secondary { display: inline-block; padding: 12px 28px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; }
    .btn-primary { background-color: #2E7D32; color: white; }
    .btn-primary:hover { background-color: #1B5E20; }
    .btn-secondary { background-color: #f0f0f0; color: #333; }
    .btn-secondary:hover { background-color: #e0e0e0; }

    /* Header */
    .header { padding: 20px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .nav-container { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 1.5rem; font-weight: 700; color: #2E7D32; }
    nav a { margin-left: 20px; text-decoration: none; color: #555; font-weight: 600; }
    nav a:hover { color: #2E7D32; }

    /* Hero Section */
    .hero { padding: 80px 0; }
    .hero-grid { display: flex; align-items: center; gap: 2rem; flex-wrap: wrap; }
    .hero-text { flex: 1 1 50%; }
    .hero-image { flex: 1 1 40%; text-align: center; }
    .hero-image img { max-width: 100%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
    h1 { font-size: 3.2rem; font-weight: 800; line-height: 1.2; margin-bottom: 1rem; }
    .highlight { color: #2E7D32; }
    .badge { display: inline-block; background: #E8F5E9; color: #2E7D32; padding: 8px 16px; border-radius: 20px; font-weight: 600; margin-bottom: 1rem; }
    .buttons { margin-top: 2rem; display: flex; gap: 1rem; }
    
    /* Auth Modal Styles */
    .auth-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 1000; }
    .auth-overlay.show { opacity: 1; visibility: visible; }
    .auth-panel { background: white; border-radius: 12px; display: flex; width: 90%; max-width: 800px; transform: scale(0.95); transition: transform 0.3s ease; }
    .auth-overlay.show .auth-panel { transform: scale(1); }
    .auth-left { flex: 1; padding: 40px; }
    .auth-right { flex: 0 0 40%; background: #2E7D32; color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px; border-radius: 0 12px 12px 0; }
    .auth-close { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #888; }
    .auth-tabs { display: flex; border-bottom: 1px solid #eee; margin-bottom: 24px; }
    .auth-tab { background: none; border: none; padding: 12px 0; margin-right: 20px; font-weight: 600; color: #888; cursor: pointer; border-bottom: 2px solid transparent; }
    .auth-tab.active { color: #2E7D32; border-bottom-color: #2E7D32; }
    .auth-form { display: none; }
    .auth-form.active { display: block; }
    .auth-form input { display: block; width: 100%; padding: 12px; margin-bottom: 16px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    .auth-actions { display: flex; gap: 1rem; align-items: center; margin-top: 1rem; }
    
    /* Footer */
    footer { text-align: center; padding: 40px 0; background: #f8f8f8; margin-top: 40px; }

    /* Other sections from your design */
    .impact, .features, .cta { padding: 60px 0; }

    @media (max-width: 768px) {
      .auth-right { display: none; }
      .hero-grid { flex-direction: column-reverse; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container nav-container">
      <div class="logo">ðŸŒ± EcoLearn</div>
      <nav>
        <a href="#challenges">Explore Challenges</a>
        <a href="dashboard.html" class="btn-primary" id="get-started-top">Get Started</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-grid">
      <div class="hero-text">
        <span class="badge">Join 2,847+ Eco Warriors</span>
        <h1>Learn Sustainability <span class="highlight">Through Action</span></h1>
        <p>Complete real-world environmental challenges, earn points, compete with peers, and make a positive impact on our planet.</p>
        <div class="buttons">
          <a href="dashboard.html" class="btn-primary" id="get-started-hero">Start Your Journey</a>
          <a href="#challenges" class="btn-secondary">Browse Challenges</a>
        </div>
      </div>
      <div class="hero-image">
        <img src="hero-image-F3e0OfrN.jpg" alt="Students planting trees">
      </div>
    </div>
  </section>
  
  <!-- Content sections from your original HTML would go here -->
  <section class="features" id="challenges">
    <div class="container">
      <h2 style="text-align: center; font-size: 2rem; margin-bottom: 1rem;">Why Choose EcoLearn?</h2>
      <p style="text-align: center; max-width: 600px; margin: 0 auto 40px;">Transform environmental education through gamified, action-based learning that creates real-world impact.</p>
    </div>
  </section>

  <!-- Auth modal (register / login) -->
  <div id="authOverlay" class="auth-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="auth-panel" role="document">
      <button id="authClose" class="auth-close" aria-label="Close authentication panel">âœ•</button>
      <div class="auth-left">
        <h3 id="authTitle">Create your EcoLearn account</h3>
        <div class="auth-tabs" role="tablist" aria-label="Authentication tabs">
          <button class="auth-tab active" data-tab="register" role="tab" aria-selected="true">Register</button>
          <button class="auth-tab" data-tab="login" role="tab" aria-selected="false">Login</button>
        </div>

        <form id="registerForm" class="auth-form active" autocomplete="on">
          <input name="username" type="text" placeholder="Username" required>
          <input name="email" type="email" placeholder="Email address" required>
          <input name="password" type="password" placeholder="Password (min. 6 characters)" required>
          <div class="auth-actions">
            <button type="submit" class="btn-primary">Register</button>
          </div>
        </form>

        <form id="loginForm" class="auth-form" autocomplete="on">
          <input name="identifier" type="text" placeholder="Username or Email" required>
          <input name="password" type="password" placeholder="Password" required>
          <div class="auth-actions">
            <button type="submit" class="btn-primary">Login</button>
          </div>
        </form>
      </div>
      <div class="auth-right" aria-hidden="true">
        <h2>Welcome to EcoLearn</h2>
        <p style="font-size:1rem; color: #C8E6C9;">Join thousands learning sustainability through action.</p>
      </div>
    </div>
  </div>

  <!-- Message/Error Display -->
  <div id="message-box" style="position: fixed; bottom: -100px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: bottom 0.5s ease-in-out; z-index: 2000;">
      <p id="message-text"></p>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 EcoLearn Platform. All rights reserved.</p>
  </footer>

  <script type="module">
    // --- Firebase SDK Imports ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Firebase Configuration and Initialization ---
    const firebaseConfig = {
      apiKey: "AIzaSyDWA-fiGiXOUp8QwPaldztN5cTQxWibghk",
      authDomain: "myloginapp-212fb.firebaseapp.com",
      projectId: "myloginapp-212fb",
      storageBucket: "myloginapp-212fb.firebasestorage.app",
      messagingSenderId: "407662156233",
      appId: "1:407662156233:web:d419bc320091e40e827018",
      measurementId: "G-P5JY41QFSS"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = 'ecolearn-app'; // A unique ID for this app's data

    // --- Modal and UI Logic ---
    const overlay = document.getElementById('authOverlay');
    const closeBtn = document.getElementById('authClose');
    const tabs = document.querySelectorAll('.auth-tab');
    const forms = { register: document.getElementById('registerForm'), login: document.getElementById('loginForm') };
    const title = document.getElementById('authTitle');

    function openAuth(initialTab = 'register') {
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
      switchTo(initialTab);
      const firstInput = forms[initialTab].querySelector('input');
      if(firstInput) firstInput.focus();
      document.body.style.overflow = 'hidden';
    }

    function closeAuth() {
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    function switchTo(tab) {
      tabs.forEach(t => {
        const is = t.dataset.tab === tab;
        t.classList.toggle('active', is);
        t.setAttribute('aria-selected', is ? 'true' : 'false');
      });
      Object.keys(forms).forEach(k => forms[k].classList.toggle('active', k === tab));
      title.textContent = tab === 'register' ? 'Create your EcoLearn account' : 'Welcome back';
    }

    tabs.forEach(t => t.addEventListener('click', () => switchTo(t.dataset.tab)));
    closeBtn.addEventListener('click', closeAuth);
    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeAuth(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAuth(); });

    document.querySelectorAll('a[href="dashboard.html"]').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        openAuth('register');
      });
    });

    // --- Message Display ---
    const showMessage = (message, isError = true) => {
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        messageText.textContent = message;
        messageBox.style.backgroundColor = isError ? '#D32F2F' : '#388E3C';
        messageBox.style.bottom = '20px';
        setTimeout(() => {
            messageBox.style.bottom = '-100px';
        }, 3000);
    };

    // --- Firebase Logic ---

    // Registration Handler
    forms.register.addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = forms.register.querySelector('input[name="username"]').value.trim();
      const email = forms.register.querySelector('input[name="email"]').value.trim();
      const password = forms.register.querySelector('input[name="password"]').value;

      if (!username || !email || password.length < 6) {
        showMessage("Please fill all fields. Password must be 6+ characters.", true);
        return;
      }

      // Check if username is taken
      const usernamesRef = collection(db, `/artifacts/${appId}/public/data/usernames`);
      const q = query(usernamesRef, where("username", "==", username));
      const querySnapshot = await getDocs(q);
      if (!querySnapshot.empty) {
        showMessage("Username is already taken. Please choose another.", true);
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await setDoc(doc(db, `/artifacts/${appId}/public/data/usernames`, user.uid), { username, email, uid: user.uid });
        await setDoc(doc(db, `/artifacts/${appId}/users/${user.uid}/profile`, 'details'), { username, email, level: 1, progress: 0 });
        
        showMessage("Account created successfully! Redirecting...", false);
        setTimeout(() => { window.location.href = 'dashboard.html'; }, 1000);
      } catch (error) {
        const friendlyMessage = error.code.includes('email-already-in-use') ? 'This email is already registered.' : error.message;
        showMessage(friendlyMessage, true);
      }
    });

    // Login Handler
    forms.login.addEventListener('submit', async (e) => {
      e.preventDefault();
      let identifier = forms.login.querySelector('input[name="identifier"]').value.trim();
      const password = forms.login.querySelector('input[name="password"]').value;
      let email = identifier;

      if (!identifier || !password) {
        showMessage("Please provide your credentials.", true);
        return;
      }

      // If identifier is not an email, assume it's a username
      if (!identifier.includes('@')) {
        try {
          const usernamesRef = collection(db, `/artifacts/${appId}/public/data/usernames`);
          const q = query(usernamesRef, where("username", "==", identifier));
          const querySnapshot = await getDocs(q);

          if (querySnapshot.empty) {
            showMessage("Username not found.", true);
            return;
          }
          email = querySnapshot.docs[0].data().email;
        } catch(error) {
          showMessage("Error finding user. Please try again.", true);
          return;
        }
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        showMessage("Logged in successfully! Redirecting...", false);
        setTimeout(() => { window.location.href = 'dashboard.html'; }, 1000);
      } catch (error) {
        showMessage("Invalid credentials. Please check and try again.", true);
      }
    });
  </script>
</body>
</html>

